choco install opencode# 桂林字牌 游戏方案（赛事平衡 + 多玩法 + 欢乐豆经济）

## 一、核心玩法规则  

广西桂林字牌（俗称“字牌”或“大字牌”）规则核心如下：  
- **牌张构成**：共有40张牌，其中小写“1~10”（一二三…十）各4张，大写“一贰叁…拾”各4张，共80张。数字“二、七、十”及其大写对应牌为红色，其余为黑色【32†L89-L97】。  
- **组牌类型**：常见胡牌组合包括顺子（如一二三或陆柒捌，必须同为小字或同为大字【32†L93-L100】）、二七十牌型、大小三搭（2张大牌+1张小牌或反之【32†L99-L100】）、坎（3张相同）、扫（2张+自摸1张同牌）等。四张同牌可形成“开舵”或“扫穿”【32†L99-L104】。  
- **出牌流程**：庄家抓21张，闲家各20张，庄家第21张亮出（称挡底）。打牌时可“吃/碰/扫”形成组合；“扫穿”“扫”“开舵”是强制规则（即若满足条件必须执行），且**放炮必胡**【32†L130-L134】。每次出牌后需摸牌补充。  
- **计分规则**：胡牌需≥10胡息；不同牌型给予基础胡息（大字牌型略高于小字）【32†L134-L142】。每10–12胡息算1舵，13–15为2舵，依此类推【32†L145-L149】。自摸、天胡、地胡等可加倍。最后根据舵数×番型×底分计算分数。
- **计分规则**： 支持语音提示倒计时设置

上述玩法以“简单易上手、变化多样”著称，而我们的技能系统应在**不破坏以上核心规则**的前提下，增加趣味策略。

## 二、技能系统设计原则  

1. **不改变核心流程**：保留“抓牌-出牌-算胡”流程，不影响摸牌顺序和牌型比较。【28†L47-L53】  
2. **平衡为重**：技能只提供信息/容错/收益微调，不做强力控牌。例如，可给出额外信息、撤销错误或略增豆收益，但不大幅提高胡率。【26†L97-L105】【28†L49-L53】  
3. **赛事公平**：每局每位玩家随机获得或预选1~2个技能，使用次数有限；技能强度设计使得胜率波动在±1%以内。较强“高风险高收益”类技能需限制使用条件。  
4. **多样性**：提供“预判”“容错”“收益”“风险”四类技能，适合不同打法。可设置赛季轮换、技能池扩展，避免模式固定。

## 三、技能示例与数值  

以下为示例技能池，可作为**开发原型**：  

- **【听势】（信息类）**：显示下家出的最近一次吃/碰牌的牌型倾向（如“顺型”“碰型”）。有助于推断对手手牌情况，但不暴露具体牌。  
- **【观流】（信息类）**：查看最近3张弃牌（不含顺序），帮助判断对手吃碰习惯。  
- **【算余】（信息类）**：提示桌面尚剩特定张数（如“剩余红三x2”）。通过剩牌推算剩余概率。  
- **【明算】（信息类）**：展示当前牌池剩余牌总数（用于残局数牌推测）。  

- **【稳手】（容错类）**：出牌后2秒内可撤回1次（本轮有效）。用于修正误点错误出牌。【26†L97-L105】  
- **【缓冲】（容错类）**：当你被点炮（他人打牌你胡牌失败）时，本局最多减去1番，但不低于基础番。缓解因失误或误判带来的番数损失。  
- **【重整】（容错类）**：重排一次提示（仅界面排序，不改变牌面），便于查看牌型。  

- **【稳豆】（收益类）**：本局失败时，欢乐豆损失减少5%。（仅影响输局收益，不改变胜率）  
- **【加码】（收益类）**：胡牌时额外获得3%欢乐豆（不叠加番型、不计入封顶）。  
- **【提速】（收益类）**：在胜利条件达到一定值（如胡牌至少6番）后，返还额外欢乐豆，如+2%。  

- **【孤注】（风险类）**：听牌后可宣告“孤注”，本局胡牌+6%欢乐豆，失败-6%。（高风险高回报，只听牌阶段可用）  
- **【反压】（风险类）**：指定对手一名：若该玩家本局失败，则额外扣除其5%欢乐豆；若你本局失败，则你额外损失5%。此技能可用作针对性高风险博弈。  

> **设计要点：** 技能加成均以“欢乐豆收益”表现，尽量不直接改变胡牌概率【28†L49-L53】。强度可通过调整参数（触发概率、收益率）微调。例如参考 **【加码3%】、**【稳豆5%】级别，小幅影响期望收益；**【孤注】** 由于高波动应设短冷却或仅限赛季事件。  

## 四、数值平衡与胜率控制  

- **胜率影响限制**：研究表明，将内容“潜力”控制在±1%很关键【28†L49-L53】。因此所有技能设计应保证实际胜率变化不超±1%，主要影响经济收益或体验。  
- **经济影响**：可允许技能对欢乐豆收益有±5%级别的调整，但需通过实验验证，避免出现“必出技能”现象。运营中定期监控“使用该技能胜率 vs 全局胜率”差值，若偏离过大（如>2%），立即调整数值。【28†L49-L53】【19†L290-L299】  

## 五、多种玩法与模式  

- **匹配对局**：1v1或2v2对局，分“休闲赛”“段位赛”。段位赛使用匹配分（MMR+段位分离），胜负影响段位积分。  
- **锦标赛模式**：定时举办赛制（如淘汰赛、循环赛），使用技能池限量版本；可设固定报酬池与入场费。  
- **闯关/剧情模式**：AI对战或关卡挑战，练习技能策略，适合新手快速上手。  
- **好友房/私人赛**：玩家自行创建房间，可开关技能模式，设置倍率等，自由娱乐。  

每种模式都需**华丽而简洁的交互界面**：牌桌布局参考**传统字牌桌面**，确保核心出牌流程一目了然。卡牌和UI元素应高对比度易辨识，避免关键信息被遮挡【26†L97-L105】【28†L49-L53】。例如：玩家手牌横向排列，无论折叠多少，牌面文字与图标要放大至可读。技能按钮和分数、豆数等常驻提示栏需清晰可见。整个界面风格遵循**简洁、地方特色和现代化**结合的原则，参考桂林当地文化元素点缀（如桂林山水剪纸风）。  

> *UI 设计关键：简洁不刺眼，玩家可“躺床上”操作而不疲劳【28†L49-L53】；重要数值字体足够大、对比度高【26†L97-L105】；卡牌布局与颜色设计应考虑色盲友好【26†L129-L134】。*

## 六、等级、积分与欢乐豆体系  

- **等级/段位**：采用段位星级制（青铜→白银→黄金…王者，每段5星），晋级须累积获胜点数。胜负均衡期望确保每局段位分增减合理。  
- **积分计算**：段位场以 Elo 算法（或 K值32）更新玩家段位【26†L97-L105】；好友局可不计段位，仅发欢乐豆或经验。  
- **欢乐豆（虚拟货币）**：游戏内主要流通货币，用于下注、复活、道具等。渠道：每日签到、任务奖励、充值购买。消耗：房费/入场费、道具商城、抽奖等。运营商对每局抽取一定比例作为“抽水”【24†L1-L4】。  
- **抽水机制**：借鉴《欢乐斗地主》模式，每局结束后收取固定欢乐豆作为系统收入【24†L1-L4】。比如入场费为底分×N，结算时按一定比例回收（如4-5%），剩余按胜负发放。**说明**：法律允许回收虚拟币，只要不可兑换现金【24†L1-L4】。  
- **破产补助**：每日定量免费补豆机制，防止新手或运气极差玩家长时间无法参赛。补助后限制参加高倍场。  
- **经济平衡**：设计基础回收率与投放量平衡公式。例如，每局系统净投放=玩家赢得的欢乐豆×（1–抽水率） – 赢家获胜的豆量，应维持长期相对稳定【19†L290-L299】。监控总供需，防止虚拟货币通胀【19†L290-L299】。  

## 七、技术架构与接口  

- **技术选型**：使用 Rust 作为服务端核心对局引擎（高性能、无GC卡顿），前端采用 Yew 框架（Rust-WASM）+ Tauri 做桌面壳。移动端可同。  
- **客户端**：负责渲染UI、处理玩家输入、播放音效动画、技能触发反馈。实时与服务器双向通信（WebSocket或WebRTC）。  
- **服务器**：负责洗牌发牌、判定胡牌、技能逻辑校验、结算分数、同步玩家状态。全部关键计算均在服务器验证以防作弊。  
- **模块划分**：  
  - 对局引擎（GameState、Player结构等，技能接口如`trait Skill`）  
  - 技能系统（技能配置、触发条件、效果实现）  
  - 经济系统（结算公式、豆币流水、抽水逻辑）  
  - 排位系统（Elo分段位、匹配逻辑）  
  - 数据存储（玩家信息、牌局记录、豆币流水表）  
  - 运维监控（实时记录胜率、技能使用率、经济流向）  

- **交互接口**：设计统一的消息协议（JSON或protobuf），例如：  
  - 玩家出牌/吃碰/胡牌动作：`{action:"play",cards:["伍","六","七"]}`  
  - 技能使用请求：`{action:"use_skill",skill_id:3,target:null}`  
  - 对局更新推送：服务器广播当前牌池、剩牌数、玩家手牌数量等  
  - 结算通知：`{action:"settle",scores:{p1:120,p2:-60,...},beans:[...]}`
  
## 八、开发注意事项  

- **稳定性与流畅度**：确保算法高效（Rust无垃圾回收），客户端操作动画平滑，网络断线支持自动重连和断线保护。根据碎片化玩法需求控制单局时长，避免过长等待【28†L53-L60】。  
- **UI 友好**：界面要美观易读，符合本地文化风格；按钮、字体色彩对比要强，重要信息排在显眼位置【26†L97-L105】【28†L49-L53】。  
- **平衡测试**：上线前进行大量模拟（蒙特卡洛）测试技能胜率影响和经济通胀压力。  
- **反作弊**：服务端洗牌、记录日志；检测异样胜率、频繁掉线行为；如有必要可引入防作弊SDK。  

## 九、参考与说明  

- 桂林字牌玩法参考自**黄金岛字牌规则**【32†L93-L104】；  
- 借鉴《欢乐斗地主》《欢乐麻将》等游戏经济模式（每局抽取欢乐豆【24†L1-L4】）以构建公平长期的虚拟经济；  
- UX设计原则参考Fray卡牌游戏UI经验，强调**阅读易**、**简洁界面**【26†L97-L105】【28†L49-L53】；  
- 虚拟经济通胀问题参考GameDeveloper经济文章【19†L290-L299】；  

以上方案提供了完整的桂林字牌游戏设计蓝图：玩法规则、技能体系、经济与抽成、UI/交互、技术架构均兼顾了竞技平衡与商业可行性，可作为直接开发落地的指导。根据实际需求，可迭代细化技术文档与美术资源，最终打造一款**界面优美、玩法丰富、平衡合理、商业可持续**的桂林字牌手游/客户端。  

